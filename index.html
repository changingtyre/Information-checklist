<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steno Videncenter - Afdækning af information</title>
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --bg-primary: #f5f5f5;
            --bg-secondary: white;
            --bg-tertiary: #f9fafb;
            --border-color: #e5e7eb;
            --text-primary: #333;
            --text-secondary: #666;
            --text-tertiary: #999;
            --step-hover-border: #3b82f6;
            --completed-bg: #ecfdf5;
            --completed-border: #a7f3d0;
            --completed-text: #065f46;
            --completed-text-light: #047857;
            --input-border: #d1d5db;
            --tip-bg: #eff6ff;
            --tip-border: #bfdbfe;
            --tip-text: #1e40af;
        }

        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #242424;
            --border-color: #404040;
            --text-primary: #e5e5e5;
            --text-secondary: #b0b0b0;
            --text-tertiary: #808080;
            --step-hover-border: #4a9eff;
            --completed-bg: #1a3a2d;
            --completed-border: #2d5a45;
            --completed-text: #7dd3a7;
            --completed-text-light: #5cb886;
            --input-border: #505050;
            --tip-bg: #1e2b3a;
            --tip-border: #2d4560;
            --tip-text: #6b9bd8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-primary);
            padding: 20px;
            line-height: 1.6;
            transition: background-color 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }

        h1 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 2rem;
            transition: color 0.3s ease;
        }
        
        .progress-section {
            margin-bottom: 30px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #3b82f6;
            border-radius: 6px;
            transition: all 0.3s ease;
            width: 0%;
        }
        
        .progress-fill.complete {
            background-color: #10b981;
        }
        
        .progress-percentage {
            text-align: center;
            margin-top: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #3b82f6;
        }
        
        .progress-percentage.complete {
            color: #10b981;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .btn {
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .btn-reset {
            background: #f3f4f6;
            color: #666;
        }
        
        .btn-reset:hover {
            background: #e5e7eb;
        }
        
        .btn-save {
            background: #10b981;
            color: white;
        }
        
        .btn-save:hover {
            background: #059669;
        }
        
        .btn-load {
            background: #3b82f6;
            color: white;
        }

        .btn-load:hover {
            background: #2563eb;
        }

        .btn-word {
            background: #2563eb;
            color: white;
        }

        .btn-word:hover {
            background: #1d4ed8;
        }

        .btn-new {
            background: #10b981;
            color: white;
        }

        .btn-new:hover {
            background: #059669;
        }

        .file-input {
            display: none;
        }
        
        .success-message {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: none;
        }
        
        .success-message.show {
            display: block;
        }
        
        .success-content {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #065f46;
            font-weight: 600;
        }
        
        .steps-container {
            margin-top: 20px;
        }
        
        .step {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .step:hover {
            border-color: var(--step-hover-border);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .step.completed {
            background: var(--completed-bg);
            border-color: var(--completed-border);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .step-content {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .step-icon {
            flex-shrink: 0;
            margin-top: 3px;
        }
        
        .step-icon svg {
            width: 24px;
            height: 24px;
        }
        
        .step-text {
            flex-grow: 1;
        }
        
        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        .step.completed .step-title {
            color: var(--completed-text);
        }

        .step-description {
            color: var(--text-secondary);
            margin-bottom: 8px;
            transition: color 0.3s ease;
        }

        .step.completed .step-description {
            color: var(--completed-text-light);
        }
        
        .step-link {
            color: #3b82f6;
            text-decoration: underline;
            font-size: 0.9rem;
            font-weight: 500;
            display: block;
            margin-bottom: 15px;
        }
        
        .step-link:hover {
            text-decoration: none;
            color: #1d4ed8;
        }
        
        .step.completed .step-link {
            color: #059669;
        }
        
        .step.completed .step-link:hover {
            color: #047857;
        }
        
        .input-fields {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            transition: border-color 0.3s ease;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group:last-child {
            margin-bottom: 0;
        }

        .input-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .input-field {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 0.9rem;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        .input-field.small {
            max-width: 300px;
        }
        
        .textarea-field {
            min-height: 60px;
            resize: vertical;
        }
        
        .tip-box {
            background: var(--tip-bg);
            border: 1px solid var(--tip-border);
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            color: var(--tip-text);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .dark-mode-toggle svg {
            width: 24px;
            height: 24px;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .notification.success {
            background-color: #10b981;
        }
        
        .notification.error {
            background-color: #ef4444;
        }
        
        .notification.info {
            background-color: #3b82f6;
        }
        
        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">
        <svg id="theme-icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg id="theme-icon-moon" style="display: none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>

    <div class="container">
        <div class="progress-section">
            <h1>Steno Videncenter - Afdækning af information <span style="font-size: 0.5em; color: var(--text-tertiary);">(v4.3)</span></h1>

            <div class="input-fields" style="margin-bottom: 25px; padding: 20px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color);">
                <div class="input-group">
                    <label class="input-label" for="project-name">Produktnavn:</label>
                    <input type="text" id="project-name" class="input-field"
                           placeholder="Indtast navn på produktet..."
                           onchange="saveMetadata('projectName', this.value)">
                </div>
                <div class="input-group" style="margin-bottom: 0;">
                    <label class="input-label" for="project-date">Dato:</label>
                    <input type="date" id="project-date" class="input-field small"
                           onchange="saveMetadata('projectDate', this.value)">
                </div>
            </div>

            <div class="progress-header">
                <span>Fremgang</span>
                <span id="progress-text">0/8 trin</span>
            </div>
            
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
            
            <div id="progress-percentage" class="progress-percentage">0% færdig</div>
            
            <div class="action-buttons">
                <button class="btn btn-new" onclick="newProject()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="12" y1="11" x2="12" y2="17"></line>
                        <line x1="9" y1="14" x2="15" y2="14"></line>
                    </svg>
                    Nyt projekt
                </button>

                <button class="btn btn-save" onclick="saveProject()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17,21 17,13 7,13 7,21"></polyline>
                        <polyline points="7,3 7,8 15,8"></polyline>
                    </svg>
                    Gem projekt
                </button>
                
                <button class="btn btn-load" onclick="document.getElementById('file-input').click()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10,9 9,9 8,9"></polyline>
                    </svg>
                    Indlæs projekt
                </button>

                <button class="btn btn-word" onclick="exportToWord()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    Eksportér til Word
                </button>
            </div>
            
            <input type="file" id="file-input" class="file-input" accept=".json" onchange="loadProject(event)">
        </div>
        
        <div id="success-message" class="success-message">
            <div class="success-content">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <path d="M22 4L12 14.01l-3-3"></path>
                </svg>
                Fantastisk! Du har gennemført alle trin i processen.
            </div>
        </div>
        
        <div class="steps-container">
            <div class="step" onclick="toggleStep(1)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-1" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">1. Hvilket emne arbejder vi med</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-1">P - Population:</label>
                                <textarea id="field1-1" class="input-field textarea-field"
                                          placeholder="Beskriv populationen..."
                                          onchange="saveData(1, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-1">I - Intervention/interesse:</label>
                                <textarea id="field2-1" class="input-field textarea-field"
                                          placeholder="Beskriv interventionen/interessen..."
                                          onchange="saveData(1, 'field2', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field3-1">C - Sammenligning/context:</label>
                                <textarea id="field3-1" class="input-field textarea-field"
                                          placeholder="Beskriv sammenligningen/konteksten..."
                                          onchange="saveData(1, 'field3', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field4-1">O - Resultat:</label>
                                <textarea id="field4-1" class="input-field textarea-field"
                                          placeholder="Beskriv resultatet..."
                                          onchange="saveData(1, 'field4', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field5-1">Andre overvejelser:</label>
                                <textarea id="field5-1" class="input-field textarea-field"
                                          placeholder="Skriv dine overvejelser her..."
                                          onchange="saveData(1, 'field5', this.value)"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step" onclick="toggleStep(2)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-2" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">2. Viden i afdelingen</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-2">Har nogen i afdelingen viden om emnet, eller er der et lignende vidensprodukt, vi kan hente inspiration og viden fra?</label>
                                <textarea id="field1-2" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(2, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-2">Evt. Hvem undersøger det:</label>
                                <input type="text" id="field2-2" class="input-field small"
                                       placeholder="..."
                                       onchange="saveData(2, 'field2', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step" onclick="toggleStep(3)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-3" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">3. Information på hjemmesider og rapporter</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-3">Hvilke hjemmesider skal vi tjekke?</label>
                                <textarea id="field1-3" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(3, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-3">Evt. Hvem undersøger det:</label>
                                <input type="text" id="field2-3" class="input-field small"
                                       placeholder="..."
                                       onchange="saveData(3, 'field2', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step" onclick="toggleStep(4)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-4" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">4. Skal vi søge efter forskning?</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-4">Mangler vi information, som vi bliver nødt til at finde forskning om? Hvad mangler vi?</label>
                                <textarea id="field1-4" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(4, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-4">Hvis ja, hvem gør det?</label>
                                <input type="text" id="field2-4" class="input-field small"
                                       placeholder="..."
                                       onchange="saveData(4, 'field2', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step" onclick="toggleStep(5)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-5" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">5. Mangler vi kompetencer?</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-5">Vi bruger fagpersoner til mange ting, f.eks. til at præcisere emnet, hjælpe med teknikken, til at afklare tvivlsspørgsmål i vidensafdækningen og til at validere indholdet. Skal vi bruge kompetencer, som ikke er en del af arbejdsgruppen? Hvem?</label>
                                <textarea id="field1-5" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(5, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-5">Hvis ja, hvem tager kontakt?</label>
                                <input type="text" id="field2-5" class="input-field small"
                                       placeholder="..."
                                       onchange="saveData(5, 'field2', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step" onclick="toggleStep(6)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-6" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">6. Hvor gemmer vi kilder og referencer?</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-6">Har vi allerede nu kilder, der er relevante for dette produkt? Hvilke?</label>
                                <textarea id="field1-6" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(6, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-6">Hvor gemmer vi kilder og referencer?</label>
                                <textarea id="field2-6" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(6, 'field2', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field3-6">Hvem har det primære overblik?</label>
                                <input type="text" id="field3-6" class="input-field small"
                                       placeholder="..."
                                       onchange="saveData(6, 'field3', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step" onclick="toggleStep(7)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-7" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">7. Har vi information nok?</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-7">Har vi information nok og er den af høj nok kvalitet? Kommer den fra personer eller organisationer, vi stoler på?</label>
                                <textarea id="field1-7" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(7, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-7">Er der noget, vi skal undersøge?</label>
                                <textarea id="field2-7" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(7, 'field2', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field3-7">Hvis ja, hvem gør det?</label>
                                <input type="text" id="field3-7" class="input-field small"
                                       placeholder="..."
                                       onchange="saveData(7, 'field3', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step" onclick="toggleStep(8)">
                <div class="step-content">
                    <div class="step-icon">
                        <svg id="icon-8" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                    </div>
                    <div class="step-text">
                        <h3 class="step-title">8. Opsummering og fortolkning</h3>
                        <p class="step-description"></p>
                        
                        <div class="input-fields" onclick="event.stopPropagation()">
                            <div class="input-group">
                                <label class="input-label" for="field1-8">Hvad er de vigtigste budskaber?</label>
                                <textarea id="field1-8" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(8, 'field1', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field2-8">Er der noget, vi skal være særligt opmærksomme på i formidlingen?</label>
                                <textarea id="field2-8" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(8, 'field2', this.value)"></textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label" for="field3-8">Med hvor stor sikkerhed kan vi formidle vores budskab? Tænk over styrkemarkører.</label>
                                <textarea id="field3-8" class="input-field textarea-field"
                                          placeholder="Skriv overvejelser her..."
                                          onchange="saveData(8, 'field3', this.value)"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 25px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color);">
            <div class="input-group">
                <label class="input-label" for="andre-overvejelser" style="font-size: 1.1rem; color: var(--text-primary);">Andre overvejelser</label>
                <textarea id="andre-overvejelser" class="input-field textarea-field"
                          style="min-height: 100px;"
                          placeholder="Skriv overvejelser her..."
                          onchange="saveMetadata('andreOvervejelser', this.value)"></textarea>
            </div>
        </div>

        <div class="tip-box">
            <strong>Tip:</strong> Klik på hvert trin for at markere det som færdigt.
            Dine ændringer gemmes automatisk i browseren. Brug "Gem projekt" for at downloade en sikkerhedskopi
            eller "Indlæs projekt" for at genindlæse gemte data.
        </div>

        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid var(--border-color);">
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">
                <strong>⚠️ Advarsel:</strong> Denne handling sletter alle data permanent.
            </p>
            <button class="btn btn-reset" onclick="resetAll()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path>
                    <path d="M21 3v5h-5"></path>
                </svg>
                Nulstil alle
            </button>
        </div>
    </div>

    <script>
        let completedSteps = new Set();
        let stepData = {};
        let metadata = {
            projectName: '',
            projectDate: '',
            andreOvervejelser: ''
        };
        const totalSteps = 8;

        // Dark mode functionality
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');

            // Toggle icon visibility
            const sunIcon = document.getElementById('theme-icon-sun');
            const moonIcon = document.getElementById('theme-icon-moon');

            if (isDarkMode) {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }

            // Save preference
            localStorage.setItem('darkMode', isDarkMode);
        }

        // Load dark mode preference
        function loadDarkModePreference() {
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-icon-sun').style.display = 'none';
                document.getElementById('theme-icon-moon').style.display = 'block';
            }
        }

        // Load dark mode on page load
        loadDarkModePreference();

        // Initialize data storage
        function initializeData() {
            // Step 1 has 5 fields (PICO + Andre overvejelser)
            stepData[1] = { field1: '', field2: '', field3: '', field4: '', field5: '' };

            // Steps 2-5 have 2 fields each
            for (let i = 2; i <= 5; i++) {
                stepData[i] = { field1: '', field2: '' };
            }

            // Steps 6-8 have 3 fields each
            for (let i = 6; i <= 8; i++) {
                stepData[i] = { field1: '', field2: '', field3: '' };
            }

            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            metadata.projectDate = today;
            document.getElementById('project-date').value = today;
        }

        // Save metadata
        function saveMetadata(field, value) {
            metadata[field] = value;
            saveToLocalStorage();
        }

        // Save data for a step
        function saveData(stepNum, field, value) {
            if (!stepData[stepNum]) {
                // Initialize with correct structure based on step
                if (stepNum === 1) {
                    stepData[stepNum] = { field1: '', field2: '', field3: '', field4: '', field5: '' };
                } else if (stepNum >= 2 && stepNum <= 5) {
                    stepData[stepNum] = { field1: '', field2: '' };
                } else {
                    stepData[stepNum] = { field1: '', field2: '', field3: '' };
                }
            }
            stepData[stepNum][field] = value;
            saveToLocalStorage();
        }

        // Save to LocalStorage
        function saveToLocalStorage() {
            const projectData = {
                completedSteps: Array.from(completedSteps),
                stepData: stepData,
                metadata: metadata,
                savedAt: new Date().toISOString()
            };
            try {
                localStorage.setItem('processTjekliste', JSON.stringify(projectData));
            } catch (e) {
                console.log('LocalStorage not available');
            }
        }

        // Load from LocalStorage
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('processTjekliste');
                if (savedData) {
                    const projectData = JSON.parse(savedData);
                    completedSteps = new Set(projectData.completedSteps || []);
                    stepData = projectData.stepData || {};
                    metadata = projectData.metadata || { projectName: '', projectDate: '' };
                    restoreUIState();
                    return true;
                }
            } catch (e) {
                console.log('Error loading from LocalStorage');
            }
            return false;
        }

        // Toggle step completion
        function toggleStep(stepId) {
            const stepElement = document.querySelector(`.step:nth-child(${stepId})`);
            const iconElement = document.getElementById(`icon-${stepId}`);
            
            if (completedSteps.has(stepId)) {
                completedSteps.delete(stepId);
                stepElement.classList.remove('completed');
                iconElement.innerHTML = '<circle cx="12" cy="12" r="10"></circle>';
                iconElement.setAttribute('stroke', '#9ca3af');
            } else {
                completedSteps.add(stepId);
                stepElement.classList.add('completed');
                iconElement.innerHTML = '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="M22 4L12 14.01l-3-3"></path>';
                iconElement.setAttribute('stroke', '#059669');
            }
            
            updateProgress();
            saveToLocalStorage();
        }

        // Update progress display
        function updateProgress() {
            const completed = completedSteps.size;
            const percentage = Math.round((completed / totalSteps) * 100);
            const isComplete = completed === totalSteps;
            
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = `${percentage}%`;
            
            if (isComplete) {
                progressFill.classList.add('complete');
            } else {
                progressFill.classList.remove('complete');
            }
            
            document.getElementById('progress-text').textContent = `${completed}/${totalSteps} trin`;
            
            const percentageElement = document.getElementById('progress-percentage');
            percentageElement.textContent = `${percentage}% færdig`;
            
            if (isComplete) {
                percentageElement.classList.add('complete');
            } else {
                percentageElement.classList.remove('complete');
            }
            
            const successMessage = document.getElementById('success-message');
            if (isComplete) {
                successMessage.classList.add('show');
            } else {
                successMessage.classList.remove('show');
            }
        }

        // Reset all data
        function resetAll() {
            if (confirm('Er du sikker på at du vil nulstille alle data? Dette kan ikke fortrydes.')) {
                completedSteps.clear();
                initializeData();

                for (let i = 1; i <= totalSteps; i++) {
                    const stepElement = document.querySelector(`.step:nth-child(${i})`);
                    const iconElement = document.getElementById(`icon-${i}`);

                    stepElement.classList.remove('completed');
                    iconElement.innerHTML = '<circle cx="12" cy="12" r="10"></circle>';
                    iconElement.setAttribute('stroke', '#9ca3af');

                    // Clear fields based on step structure
                    const maxFields = (i === 1) ? 5 : ((i >= 6) ? 3 : 2);
                    for (let f = 1; f <= maxFields; f++) {
                        const field = document.getElementById(`field${f}-${i}`);
                        if (field) field.value = '';
                    }
                }

                updateProgress();
                saveToLocalStorage();
                showNotification('Alle data er nulstillet.', 'info');
            }
        }

        // Start new project
        function newProject() {
            // Check if there is any data
            const hasData = completedSteps.size > 0 ||
                           metadata.projectName !== '' ||
                           Object.values(stepData).some(step => step.responsible !== '' || step.notes !== '');

            if (hasData) {
                const userChoice = confirm('Du har et igangværende projekt.\n\nVil du gemme det nuværende projekt først?\n\nOK = Gem og start nyt projekt\nAnnuller = Start nyt projekt uden at gemme');

                if (userChoice) {
                    // User wants to save first
                    saveProject();
                    // Give a moment for the download to start
                    setTimeout(() => {
                        clearAndStartNew();
                    }, 500);
                } else {
                    // User doesn't want to save
                    if (confirm('Er du sikker? Alt i det nuværende projekt vil gå tabt.')) {
                        clearAndStartNew();
                    }
                }
            } else {
                // No data, just start fresh
                clearAndStartNew();
            }
        }

        // Clear all data and start fresh
        function clearAndStartNew() {
            completedSteps.clear();

            // Reset metadata
            metadata = {
                projectName: '',
                projectDate: new Date().toISOString().split('T')[0],
                andreOvervejelser: ''
            };

            // Clear project name field
            document.getElementById('project-name').value = '';
            document.getElementById('project-date').value = metadata.projectDate;
            document.getElementById('andre-overvejelser').value = '';

            // Initialize fresh step data
            initializeData();

            // Reset all step UI elements
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.querySelector(`.step:nth-child(${i})`);
                const iconElement = document.getElementById(`icon-${i}`);

                stepElement.classList.remove('completed');
                iconElement.innerHTML = '<circle cx="12" cy="12" r="10"></circle>';
                iconElement.setAttribute('stroke', '#9ca3af');

                // Clear fields based on step structure
                const maxFields = (i === 1) ? 5 : ((i >= 6) ? 3 : 2);
                for (let f = 1; f <= maxFields; f++) {
                    const field = document.getElementById(`field${f}-${i}`);
                    if (field) field.value = '';
                }
            }

            updateProgress();
            saveToLocalStorage();
            showNotification('Nyt projekt startet!', 'success');
        }

        // Save project to file
        function saveProject() {
            const projectData = {
                completedSteps: Array.from(completedSteps),
                stepData: stepData,
                metadata: metadata,
                savedAt: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(projectData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            link.download = `proces-tjekliste-${dateStr}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Projekt gemt! Filen er downloadet.', 'success');
        }

        // Load project from file
        function loadProject(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const projectData = JSON.parse(e.target.result);

                    if (!projectData.completedSteps || !projectData.stepData) {
                        throw new Error('Invalid file format');
                    }

                    completedSteps = new Set(projectData.completedSteps);
                    stepData = projectData.stepData;
                    metadata = projectData.metadata || { projectName: '', projectDate: '' };

                    restoreUIState();
                    saveToLocalStorage();

                    showNotification('Projekt indlæst succesfuldt!', 'success');
                    
                } catch (error) {
                    showNotification('Fejl ved indlæsning af fil. Kontroller at det er den rigtige filtype.', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Restore UI state
        function restoreUIState() {
            // Restore metadata fields
            document.getElementById('project-name').value = metadata.projectName || '';
            document.getElementById('project-date').value = metadata.projectDate || '';
            document.getElementById('andre-overvejelser').value = metadata.andreOvervejelser || '';

            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.querySelector(`.step:nth-child(${i})`);
                const iconElement = document.getElementById(`icon-${i}`);

                if (completedSteps.has(i)) {
                    stepElement.classList.add('completed');
                    iconElement.innerHTML = '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="M22 4L12 14.01l-3-3"></path>';
                    iconElement.setAttribute('stroke', '#059669');
                } else {
                    stepElement.classList.remove('completed');
                    iconElement.innerHTML = '<circle cx="12" cy="12" r="10"></circle>';
                    iconElement.setAttribute('stroke', '#9ca3af');
                }

                // Restore fields based on step structure
                if (stepData[i]) {
                    const maxFields = (i === 1) ? 5 : ((i >= 6) ? 3 : 2);
                    for (let f = 1; f <= maxFields; f++) {
                        const field = document.getElementById(`field${f}-${i}`);
                        if (field) {
                            field.value = stepData[i][`field${f}`] || '';
                        }
                    }
                }
            }

            updateProgress();
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Convert text with URLs to TextRun array with hyperlinks
        function textToRunsWithLinks(text, size = 22, font = 'Calibri') {
            if (!text || text === 'Ingen noter') {
                return [new docx.TextRun({ text: text, size: size, font: font })];
            }

            // Regular expression to find URLs
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const parts = [];
            let lastIndex = 0;
            let match;

            while ((match = urlRegex.exec(text)) !== null) {
                // Add text before URL
                if (match.index > lastIndex) {
                    parts.push(new docx.TextRun({
                        text: text.substring(lastIndex, match.index),
                        size: size,
                        font: font
                    }));
                }

                // Add URL as hyperlink
                parts.push(new docx.ExternalHyperlink({
                    children: [
                        new docx.TextRun({
                            text: match[0],
                            size: size,
                            font: font,
                            color: "0563C1",
                            underline: {}
                        })
                    ],
                    link: match[0]
                }));

                lastIndex = match.index + match[0].length;
            }

            // Add remaining text after last URL
            if (lastIndex < text.length) {
                parts.push(new docx.TextRun({
                    text: text.substring(lastIndex),
                    size: size,
                    font: font
                }));
            }

            return parts.length > 0 ? parts : [new docx.TextRun({ text: text, size: size, font: font })];
        }

        // Export to Word document
        async function exportToWord() {
            try {
                // Check if docx library is loaded
                if (typeof docx === 'undefined') {
                    showNotification('Docx bibliotek ikke indlæst. Tjek internet forbindelse.', 'error');
                    return;
                }

                // Region H blue color (RGB: 0, 94, 122 = #005E7A)
                const regionHBlue = "005E7A";

                // Step titles
                const stepTitles = [
                    'Hvilket emne arbejder vi med',
                    'Viden i afdelingen',
                    'Information på hjemmesider og rapporter',
                    'Skal vi søge efter forskning?',
                    'Mangler vi kompetencer?',
                    'Hvor gemmer vi kilder og referencer?',
                    'Har vi information nok?',
                    'Opsummering og fortolkning'
                ];

                // Create document sections
                const sections = [];

                // Title with Region H blue
                sections.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: 'Steno Videncenter - Afdækning af information',
                                bold: true,
                                size: 32,
                                color: regionHBlue,
                                font: 'Calibri'
                            })
                        ],
                        spacing: { after: 300 }
                    })
                );

                // Horizontal line (using border)
                sections.push(
                    new docx.Paragraph({
                        border: {
                            bottom: {
                                color: regionHBlue,
                                space: 1,
                                style: docx.BorderStyle.SINGLE,
                                size: 20
                            }
                        },
                        spacing: { after: 400 }
                    })
                );

                // Metadata section
                if (metadata.projectName) {
                    sections.push(
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: 'Produktnavn: ',
                                    bold: true,
                                    size: 22,
                                    font: 'Calibri'
                                }),
                                new docx.TextRun({
                                    text: metadata.projectName,
                                    size: 22,
                                    font: 'Calibri'
                                })
                            ],
                            spacing: { after: 150 }
                        })
                    );
                }

                if (metadata.projectDate) {
                    sections.push(
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: 'Dato: ',
                                    bold: true,
                                    size: 22,
                                    font: 'Calibri'
                                }),
                                new docx.TextRun({
                                    text: metadata.projectDate,
                                    size: 22,
                                    font: 'Calibri'
                                })
                            ],
                            spacing: { after: 150 }
                        })
                    );
                }

                // Progress summary with background
                const completedCount = completedSteps.size;
                const percentage = Math.round((completedCount / totalSteps) * 100);
                const progressText = `Status: ${completedCount}/${totalSteps} trin gennemført (${percentage}%)`;

                sections.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: progressText,
                                italics: true,
                                size: 22,
                                font: 'Calibri',
                                color: regionHBlue
                            })
                        ],
                        spacing: { after: 600 },
                        shading: {
                            fill: "E6F2F5" // Light blue background
                        },
                        indent: { left: 200 }
                    })
                );

                // Field labels for each step
                const fieldLabels = {
                    1: [
                        'P - Population',
                        'I - Intervention/interesse',
                        'C - Sammenligning/context',
                        'O - Resultat',
                        'Andre overvejelser'
                    ],
                    2: [
                        'Har nogen i afdelingen viden om emnet, eller er der et lignende vidensprodukt, vi kan hente inspiration og viden fra?',
                        'Evt. Hvem undersøger det'
                    ],
                    3: [
                        'Hvilke hjemmesider skal vi tjekke?',
                        'Evt. Hvem undersøger det'
                    ],
                    4: [
                        'Mangler vi information, som vi bliver nødt til at finde forskning om? Hvad mangler vi?',
                        'Hvis ja, hvem gør det?'
                    ],
                    5: [
                        'Vi bruger fagpersoner til mange ting, f.eks. til at præcisere emnet, hjælpe med teknikken, til at afklare tvivlsspørgsmål i vidensafdækningen og til at validere indholdet. Skal vi bruge kompetencer, som ikke er en del af arbejdsgruppen? Hvem?',
                        'Hvis ja, hvem tager kontakt?'
                    ],
                    6: [
                        'Har vi allerede nu kilder, der er relevante for dette produkt? Hvilke?',
                        'Hvor gemmer vi kilder og referencer?',
                        'Hvem har det primære overblik?'
                    ],
                    7: [
                        'Har vi information nok og er den af høj nok kvalitet? Kommer den fra personer eller organisationer, vi stoler på?',
                        'Er der noget, vi skal undersøge?',
                        'Hvis ja, hvem gør det?'
                    ],
                    8: [
                        'Hvad er de vigtigste budskaber?',
                        'Er der noget, vi skal være særligt opmærksomme på i formidlingen?',
                        'Med hvor stor sikkerhed kan vi formidle vores budskab? Tænk over styrkemarkører.'
                    ]
                };

                // Add each step
                for (let i = 1; i <= totalSteps; i++) {
                    const isCompleted = completedSteps.has(i);
                    const status = isCompleted ? '✓ Gennemført' : '○ Ikke gennemført';

                    // Step heading with blue color
                    sections.push(
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `${i}. ${stepTitles[i - 1]}`,
                                    bold: true,
                                    size: 28,
                                    font: 'Calibri',
                                    color: regionHBlue
                                })
                            ],
                            spacing: { before: 400, after: 200 }
                        })
                    );

                    // Status with green checkmark or grey circle
                    sections.push(
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: 'Status: ',
                                    bold: true,
                                    size: 22,
                                    font: 'Calibri'
                                }),
                                new docx.TextRun({
                                    text: status,
                                    size: 22,
                                    font: 'Calibri',
                                    color: isCompleted ? "10b981" : "666666"
                                })
                            ],
                            spacing: { after: 250 }
                        })
                    );

                    // Add each field for this step
                    const labels = fieldLabels[i];
                    for (let f = 0; f < labels.length; f++) {
                        const fieldNum = f + 1;
                        const fieldValue = stepData[i]?.[`field${fieldNum}`] || 'Ikke udfyldt';

                        // Field label
                        sections.push(
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: labels[f] + ':',
                                        bold: true,
                                        size: 22,
                                        font: 'Calibri'
                                    })
                                ],
                                spacing: { after: 100 }
                            })
                        );

                        // Field content with light background and indentation (with clickable links)
                        sections.push(
                            new docx.Paragraph({
                                children: textToRunsWithLinks(fieldValue, 22, 'Calibri'),
                                spacing: { after: 200 },
                                shading: {
                                    fill: "F9FAFB" // Light grey background
                                },
                                indent: { left: 300, right: 300 }
                            })
                        );
                    }

                    // Add extra spacing after the last field of each step
                    sections.push(
                        new docx.Paragraph({
                            text: '',
                            spacing: { after: 200 }
                        })
                    );
                }

                // Add "Andre overvejelser" section if it has content
                if (metadata.andreOvervejelser && metadata.andreOvervejelser.trim() !== '') {
                    sections.push(
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: 'Andre overvejelser',
                                    bold: true,
                                    size: 28,
                                    font: 'Calibri',
                                    color: regionHBlue
                                })
                            ],
                            spacing: { before: 400, after: 200 }
                        })
                    );

                    sections.push(
                        new docx.Paragraph({
                            children: textToRunsWithLinks(metadata.andreOvervejelser, 22, 'Calibri'),
                            spacing: { after: 400 },
                            shading: {
                                fill: "F9FAFB" // Light grey background
                            },
                            indent: { left: 300, right: 300 }
                        })
                    );
                }

                // Create document
                const doc = new docx.Document({
                    sections: [{
                        properties: {
                            page: {
                                margin: {
                                    top: 1440,  // 1 inch = 1440 twips
                                    right: 1440,
                                    bottom: 1440,
                                    left: 1440
                                }
                            }
                        },
                        children: sections
                    }]
                });

                // Generate and download
                const blob = await docx.Packer.toBlob(doc);
                const fileName = metadata.projectName
                    ? `${metadata.projectName.replace(/[^a-z0-9]/gi, '_')}_${metadata.projectDate || 'rapport'}.docx`
                    : `proces-tjekliste_${metadata.projectDate || new Date().toISOString().split('T')[0]}.docx`;

                saveAs(blob, fileName);
                showNotification('Word-dokument eksporteret succesfuldt!', 'success');

            } catch (error) {
                console.error('Export error:', error);
                console.error('Error details:', error.message, error.stack);
                showNotification('Fejl ved eksport: ' + error.message, 'error');
            }
        }

        // Initialize
        initializeData();

        if (!loadFromLocalStorage()) {
            updateProgress();
        }

        if (!localStorage.getItem('processTjekliste')) {
            setTimeout(() => {
                showNotification('Tip: Dine ændringer gemmes automatisk i browseren. Brug "Gem projekt" for sikker backup.', 'info');
            }, 2000);
        }
    </script>
</body>
</html>
